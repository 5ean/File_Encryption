<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="File encryptor : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>File encryption</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/5ean/File_Encryption">View on GitHub</a>

          <h1 id="project_title">File Encryptor</h1>
          <h2 id="project_tagline">An example of developing a simple encryptor in C# and cool Syntactic sugar in .Net</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/5ean/File_Encryption/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/5ean/File_Encryption/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h3>
                <a id="About-this-Encryptor" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>About this Encryptor
            </h3>
            <p>I think the majority of people have some files they want to protect, such as their contact lists, passwords or family photos and videos. I do as well. I used a free file protection application to handle the issue until the makers upgraded the app. Unfortunately, the newest version cannot properly decrypt the files encrypted by the previous version. I found the change to be ridiculous and took it in my own hands to write a small encryptor for my own. Here is it: </p>

            <h3>
                <a id="File-Encryptor" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>File Encryptor
            </h3>
            <p>The tool is as follows. You can simply choose any kind of files you want. Based on my test, it can handle larger files such as HD movie quite well. </p>
            <hr />
            <img src="images/1.PNG" alt="encryptor" width="400" height="300" />
            <hr />
            <p>After you choose the file and input the password twice correctly, the "Encrypt" button will be enabled. Click the button and the tool will start to encrypt as shown:</p>
            <p>The decryption operation is the same</p>
            <hr />
            <img src="images/2.PNG" alt="encryptor" width="400" height="300" />
            <hr />

            <p>After encryption, the tool generates the encrypted file with ".cryp" file extention</p>
            <hr />
            <img src="images/3.PNG" alt="encryptor" width="200" height="150" />
            <hr />

            <h3>
                <a id="File-Encryptor" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntactic sugar from .Net
            </h3>
            <p>Since it is my playground, I kind of overused some cool features in C# just for fun. New C# developers may be interested in it.</p>
            <p>I made encrypt and decrypt methods as extension methods for FileInfo. Extension methods make the sweet LINQ possible. If you are interested in it, please go check <a href="https://msdn.microsoft.com/en-CA/library/bb383977.aspx" class="user-mention">Extension Methods (C# Programming Guide)</a> </p>
            <pre><code>public static IEnumerable<double> EncryptFile(this FileInfo fileInfo, string password)
//when you call this method
var target = new FileInfo(fileName);
target.EncryptFile(Password)
           </code></pre>

            <p>To measure the progress of encryption/decryption, the meothd return IEnumerable&lt;double&gt; with <a href="https://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx" class="user-mention">yield</a>. The method returns the percentage of progress when every 1 percent of encryption/decrpytion job is done.</p>
            <p>EncryptFile</p>
            <pre><code>
public static IEnumerable&lt;double&gt; EncryptFile(this FileInfo fileInfo, string password)
{
    FileStream fsCrypt = null;
    FileStream fsIn = null;
    CryptoStream cs = null;
    RijndaelManaged RMCrypto = null;
    try
    {
        
        UnicodeEncoding UE = new UnicodeEncoding();
        byte[] temp = UE.GetBytes(password).Where(p => p!= 0).Select(a =>a).ToArray();
        byte[] key = UE.GetBytes("****************").Where(p => p != 0).Select(a => a).ToArray();
        if (temp.Length > 16) throw new ArgumentException("Password can't be more than 16 characters");
        for (int i = 0; i < temp.Length; i++)
        {
            key[i] = temp[i];
        }
        string cryptFile = fileInfo.FullName+".cryp";
        fsCrypt = new FileStream(cryptFile, FileMode.Create);
        RMCrypto = new RijndaelManaged();
        RMCrypto.Key = key;
        RMCrypto.IV = key;
        ICryptoTransform transform = RMCrypto.CreateEncryptor();
        cs = new CryptoStream(fsCrypt,
            transform,
            CryptoStreamMode.Write);
        fsIn = fileInfo.Open(FileMode.Open);
        var count = 1;
        int data;
        while ((data = fsIn.ReadByte()) != -1)
        {
            cs.WriteByte((byte)data);
            if (count % (fsIn.Length / 100) == 0) 
                yield return count / (fsIn.Length / 100);
            count++;
        }
            
    }
    finally
    {
        if (fsIn != null) fsIn.Close();
        if (cs != null) cs.Close();
        if (fsCrypt != null) fsCrypt.Close();
        if (RMCrypto != null) RMCrypto.Dispose();
    }
}
            </code></pre>
            <p>DecryptFile</p>
            <pre><code>
public static IEnumerable&lt;double&gt; DecryptFile(this FileInfo fileInfo, string password)
{
      FileStream fsCrypt = null;
      FileStream fsOut = null;
      CryptoStream cs = null;
      RijndaelManaged RMCrypto = null;
      try
      {
          UnicodeEncoding UE = new UnicodeEncoding();
          byte[] temp = UE.GetBytes(password).Where(p => p != 0).Select(a => a).ToArray();
          byte[] key = UE.GetBytes("****************").Where(p => p != 0).Select(a => a).ToArray();
          if (temp.Length > 16) throw new ArgumentException("Password can't be more than 16 characters");
          for (int i = 0; i < temp.Length; i++)
          {
              key[i] = temp[i];
          }
          fsCrypt = fileInfo.Open(FileMode.Open);
          RMCrypto = new RijndaelManaged();
          cs = new CryptoStream(fsCrypt,
             RMCrypto.CreateDecryptor(key, key),
             CryptoStreamMode.Read);
          var outputFile = fileInfo.FullName.Remove(fileInfo.FullName.Length - 4);
          fsOut = new FileStream(outputFile, FileMode.Create);
          var count = 1;
          int data;
          while ((data = cs.ReadByte()) != -1)
          {
              fsOut.WriteByte((byte)data);
              if (count % (fsCrypt.Length / 100) == 0)
                  yield return count / (fsCrypt.Length / 100);
              count++;
          }
      }
      finally
      {
          if (fsOut != null) fsOut.Close();
          if (cs != null) cs.Close();
          if (fsCrypt != null) fsCrypt.Close();
          if (RMCrypto != null) RMCrypto.Dispose();
      }
}
            </code></pre>
            <p>And in xaml.cs file. You need a thread to handle the cryption job</p>
            <pre><code>
Task.Factory.StartNew(() => 
{
    foreach (var percentage in target.EncryptFile(passwordbox1.Password))
    {
        Dispatcher.BeginInvoke(new Action(() =>
        {
            prgbar.Value = percentage;
            prgText.Text = string.Format("Encrypeted {0}%", percentage);
        }), null);
    }
    Dispatcher.BeginInvoke(new Action(
        () => prgGrid.Visibility = System.Windows.Visibility.Collapsed
        ));
});
            </code></pre>
         </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">File encryption maintained by <a href="https://github.com/5ean">5ean</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
